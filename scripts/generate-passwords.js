#!/usr/bin/env node

/**
 * Password Viewer for Protected Content
 * 
 * This script displays passwords from content-config.json.
 * Passwords are generated by the generate-seed-config.js script.
 */

import fs from 'fs'
import path from 'path'
import { fileURLToPath } from 'url'

const __filename = fileURLToPath(import.meta.url)
const __dirname = path.dirname(__filename)

const CONFIG_FILE = path.join(__dirname, '..', 'api', 'scripts', 'content-config.json')

function loadContentConfig() {
  if (!fs.existsSync(CONFIG_FILE)) {
    console.log('‚ùå content-config.json not found')
    console.log('   Run "node api/scripts/generate-seed-config.js" first to generate the configuration.')
    process.exit(1)
  }
  
  const configContent = fs.readFileSync(CONFIG_FILE, 'utf8')
  return JSON.parse(configContent)
}

// Get command line arguments
const args = process.argv.slice(2)

if (args.length === 0) {
  console.log('üîê Content Password Viewer\n')
  console.log('Usage:')
  console.log('  node scripts/generate-passwords.js <type> <slug>')
  console.log('  node scripts/generate-passwords.js all')
  console.log('')
  console.log('Examples:')
  console.log('  node scripts/generate-passwords.js ideas local-first-ai')
  console.log('  node scripts/generate-passwords.js all')
  console.log('')
  console.log('Note: Passwords are read from content-config.json')
  console.log('      Generate new passwords with: node api/scripts/generate-seed-config.js')
  process.exit(0)
}

const config = loadContentConfig()

if (args[0] === 'all') {
  console.log('üîê All Content Passwords\n')
  
  const passwordRules = config.rules.filter(rule => rule.password)
  
  if (passwordRules.length === 0) {
    console.log('No password-protected content found.')
    process.exit(0)
  }
  
  passwordRules.forEach(rule => {
    console.log(`${rule.type}/${rule.slug}: ${rule.password}`)
  })
} else if (args.length === 2) {
  const [type, slug] = args
  const rule = config.rules.find(r => r.type === type && r.slug === slug)
  
  if (!rule) {
    console.log(`‚ùå No rule found for ${type}/${slug}`)
    process.exit(1)
  }
  
  if (!rule.password) {
    console.log(`‚ùå ${type}/${slug} is not password-protected`)
    process.exit(1)
  }
  
  console.log(`üîê Password for ${type}/${slug}:`)
  console.log(rule.password)
} else {
  console.error('‚ùå Invalid arguments. Use: node scripts/generate-passwords.js <type> <slug>')
  process.exit(1)
}
